# –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ª–µ–Ω—Ç–∞ (Infinite Scroll) - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ü—Ä–æ–±–ª–µ–º—ã

## üìã –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ª–µ–Ω—Ç–∞

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ª–µ–Ω—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é:
- **Intersection Observer API** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- **Zustand Store** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **React Hooks** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∑–∞–≥—Ä—É–∑–∫–∏

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### **SimpleGallery.tsx** - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≥–∞–ª–µ—Ä–µ–∏
```typescript
// Intersection Observer –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–Ω—Ü–∞ —Å–ø–∏—Å–∫–∞
useEffect(() => {
  const observer = new IntersectionObserver(
    (entries) => {
      if (entry.isIntersecting && hasNextPage && !isLoadingMore) {
        onLoadMore(); // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      }
    },
    {
      rootMargin: '100px', // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞ 100px –¥–æ –∫–æ–Ω—Ü–∞
      threshold: 0.1
    }
  );
  observer.observe(sentinelRef.current);
}, [hasNextPage, isLoadingMore, onLoadMore]);
```

#### **GalleryPage.tsx** - –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
```typescript
// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
const loadMoreStickerSets = useCallback(() => {
  if (currentPage < totalPages - 1 && !uiState.isLoadingMore) {
    fetchStickerSets(currentPage + 1, true, uiState.selectedCategories);
    // ‚Üë isLoadMore=true –æ–∑–Ω–∞—á–∞–µ—Ç –î–û–ë–ê–í–õ–ï–ù–ò–ï –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –¥–∞–Ω–Ω—ã–º
  }
}, [currentPage, totalPages, uiState.isLoadingMore, fetchStickerSets]);
```

#### **useStickerStore.ts** - Store –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
```typescript
addStickerSets: (newStickerSets: StickerSetResponse[]) => {
  const { stickerSets } = get();
  // –ò–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  const existingIds = new Set(stickerSets.map(s => s.id));
  const uniqueNewSets = newStickerSets.filter(s => !existingIds.has(s.id));
  // –î–û–ë–ê–í–õ–Ø–ï–ú –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
  set({ stickerSets: [...stickerSets, ...uniqueNewSets] });
}
```

### 3. –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –≤–Ω–∏–∑
   ‚Üì
2. Intersection Observer –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä (sentinel)
   ‚Üì
3. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è onLoadMore() ‚Üí loadMoreStickerSets()
   ‚Üì
4. fetchStickerSets(page + 1, isLoadMore=true)
   ‚Üì
5. API –∑–∞–ø—Ä–æ—Å: GET /api/stickersets?page=2&size=20
   ‚Üì
6. addStickerSets([...–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ]) - –î–û–ë–ê–í–õ–ï–ù–ò–ï –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
   ‚Üì
7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ currentPage, totalPages
   ‚Üì
8. –ì–∞–ª–µ—Ä–µ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
```

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–∏ –Ω–∞ 3-–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

### –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

–í `GalleryPage.tsx` –±—ã–ª–∏ –¥–≤–∞ `useEffect`, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞–ª–∏ **–ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É** –≥–∞–ª–µ—Ä–µ–∏:

```typescript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ù–´–ô –ö–û–î (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
useEffect(() => {
  if (isReady) {
    fetchStickerSets(0, false, uiState.selectedCategories);
    // ‚Üë page=0, isLoadMore=false ‚Üí –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê
  }
}, [uiState.selectedCategories, uiState.sortByLikes]);

useEffect(() => {
  if (isReady) {
    fetchStickerSets(0, false, uiState.selectedCategories);
    // ‚Üë page=0, isLoadMore=false ‚Üí –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê
  }
}, [isReady, uiState.manualInitData]);
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∏—Ç –¥–æ 3-–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. `fetchStickerSets` –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`uiState.sortByLikes`, `uiState.manualInitData`)
3. `useEffect` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `fetchStickerSets`
4. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `fetchStickerSets(0, false, ...)` ‚Üí **–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã**
5. –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã) **–∑–∞–º–µ–Ω—è—é—Ç—Å—è** –Ω–∞ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞–≤–µ—Ä—Ö

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏:

```typescript
// ‚úÖ –î–û–ë–ê–í–õ–ï–ù–ò–ï –¥–∞–Ω–Ω—ã—Ö (–±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ª–µ–Ω—Ç–∞)
fetchStickerSets(page + 1, true, categories);
// ‚Üí addStickerSets([...–Ω–æ–≤—ã–µ]) ‚Üí [...—Å—Ç–∞—Ä—ã–µ, ...–Ω–æ–≤—ã–µ]

// ‚ùå –ó–ê–ú–ï–ù–ê –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)
fetchStickerSets(0, false, categories);
// ‚Üí setStickerSets([...–Ω–æ–≤—ã–µ]) ‚Üí [...–Ω–æ–≤—ã–µ] (—Å—Ç–∞—Ä—ã–µ —É–¥–∞–ª–µ–Ω—ã)
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:

```typescript
// –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
const hasInitializedRef = useRef(false);

// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∂–µ –±—ã–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
useEffect(() => {
  if (isReady && hasInitializedRef.current) {
    // –¢–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    fetchStickerSets(0, false, uiState.selectedCategories);
  }
}, [uiState.selectedCategories, uiState.sortByLikes, isReady, fetchStickerSets]);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
useEffect(() => {
  if (isReady && !hasInitializedRef.current) {
    fetchStickerSets(0, false, uiState.selectedCategories);
    hasInitializedRef.current = true; // –ü–æ–º–µ—á–∞–µ–º, —á—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞
  }
}, [isReady, uiState.manualInitData, fetchStickerSets]);
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `hasInitializedRef` - —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
2. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
3. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∂–µ –±—ã–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
4. ‚úÖ `fetchStickerSets` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã React

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: [1, 2, 3, ..., 20] ‚úÖ
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: [1, 2, 3, ..., 20, 21, 22, ..., 40] ‚úÖ
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: [1, 2, 3, ..., 20] ‚ùå (–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞!)
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: [1, 2, 3, ..., 20] ‚úÖ
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: [1, 2, 3, ..., 20, 21, 22, ..., 40] ‚úÖ
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: [1, 2, 3, ..., 20, 21, 22, ..., 40, 41, 42, ..., 60] ‚úÖ
```

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–∫—Ä–æ–ª–ª–∞

–í `SimpleGallery.tsx` –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–∫—Ä–æ–ª–ª–∞:

```typescript
const scrollPositionRef = useRef<number>(0);

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
useEffect(() => {
  if (containerRef.current && isLoadingMore) {
    scrollPositionRef.current = containerRef.current.scrollTop;
  }
}, [isLoadingMore]);

// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
useEffect(() => {
  if (containerRef.current && !isLoadingMore && scrollPositionRef.current > 0) {
    requestAnimationFrame(() => {
      if (containerRef.current) {
        containerRef.current.scrollTop = scrollPositionRef.current;
      }
    });
  }
}, [isLoadingMore, packs.length]);
```

## üìù –ò—Ç–æ–≥–∏

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ª–µ–Ω—Ç–∞:
1. ‚úÖ **Intersection Observer** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞
2. ‚úÖ **addStickerSets** –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
3. ‚úÖ **–ü–æ–∑–∏—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
4. ‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö ID

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ –£–±—Ä–∞–Ω–∞ –ª–∏—à–Ω—è—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
3. ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ useEffect
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

