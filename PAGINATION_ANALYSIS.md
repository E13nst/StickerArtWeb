# –ê–Ω–∞–ª–∏–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –Ω–∞ GalleryPage

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** (—Å—Ç—Ä–æ–∫–∞ 508-520):
   - –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (page=0)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `fetchStickerSets(0, false, selectedCategories)`

2. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** (—Å—Ç—Ä–æ–∫–∏ 212-319):
   - `fetchStickerSets` –¥–µ–ª–∞–µ—Ç API –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `page`, `size=20`
   - –ü—Ä–∏ `isLoadMore=true` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `addStickerSets` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –¥–∞–Ω–Ω—ã–º
   - –ü—Ä–∏ `isLoadMore=false` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `setStickerSets` –¥–ª—è –∑–∞–º–µ–Ω—ã –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ `setPagination(response.number || page, ...)`

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã** (—Å—Ç—Ä–æ–∫–∏ 322-326):
   - `loadMoreStickerSets` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: `currentPage < totalPages - 1 && !isLoadingMore`
   - –í—ã–∑—ã–≤–∞–µ—Ç `fetchStickerSets(currentPage + 1, true, selectedCategories)`

4. **Intersection Observer –≤ SimpleGallery**:
   - –û—Å–Ω–æ–≤–Ω–æ–π observer —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞ 100px –¥–æ –∫–æ–Ω—Ü–∞ —Å–ø–∏—Å–∫–∞
   - Prefetch observer —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞ 400px –¥–æ –∫–æ–Ω—Ü–∞ —Å–ø–∏—Å–∫–∞
   - –û–±–∞ –≤—ã–∑—ã–≤–∞—é—Ç `onLoadMore` (–∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è `loadMoreStickerSets`)

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –≤—ã–∑—ã–≤–∞—é—â–∏–µ –∫—Ä–∞—à –ø–æ—Å–ª–µ 3-–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #1: Race Condition –≤ loadMoreStickerSets

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∏ 322-326

**–ü—Ä–æ–±–ª–µ–º–∞**: 
```typescript
const loadMoreStickerSets = useCallback(() => {
  if (currentPage < totalPages - 1 && !isLoadingMore) {
    fetchStickerSets(currentPage + 1, true, selectedCategories);
  }
}, [currentPage, totalPages, isLoadingMore, selectedCategories, fetchStickerSets]);
```

–ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π `!isLoadingMore` –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `setIsLoadingMore(true)` –≤–Ω—É—Ç—Ä–∏ `fetchStickerSets` –µ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫. –ï—Å–ª–∏ –¥–≤–∞ observer'–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π –∏ prefetch) —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø–æ—á—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –æ–±–∞ –º–æ–≥—É—Ç –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –≤—ã–∑–≤–∞—Ç—å `fetchStickerSets` –¥–≤–∞–∂–¥—ã.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `currentPage`
- –í–æ–∑–º–æ–∂–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ `stickerSets`
- –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–∞–Ω–∏—Ü

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ response.number === 0

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∞ 294

**–ü—Ä–æ–±–ª–µ–º–∞**:
```typescript
setPagination(
  response.number || page,  // ‚ùå –ï—Å–ª–∏ response.number === 0, –≤–µ—Ä–Ω–µ—Ç—Å—è page –≤–º–µ—Å—Ç–æ 0
  response.totalPages || 0,
  response.totalElements || 0
);
```

–ï—Å–ª–∏ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `response.number = 0` (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞), –≤—ã—Ä–∞–∂–µ–Ω–∏–µ `response.number || page` –≤–µ—Ä–Ω–µ—Ç `page` –≤–º–µ—Å—Ç–æ `0`, —á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- `currentPage` –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—Ä–æ—à–µ–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –í–æ–∑–º–æ–∂–µ–Ω –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –∑–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –ø—Ä–æ–ø—É—Å–∫ —Å—Ç—Ä–∞–Ω–∏—Ü

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #3: –î–≤–æ–π–Ω–æ–π Intersection Observer

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: SimpleGallery.tsx —Å—Ç—Ä–æ–∫–∏ 223-280 –∏ 282-328

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –û—Å–Ω–æ–≤–Ω–æ–π observer —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞ 100px –¥–æ –∫–æ–Ω—Ü–∞
- Prefetch observer —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞ 400px –¥–æ –∫–æ–Ω—Ü–∞
- –û–±–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç `!isLoadingMore`, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –∞—Ç–æ–º–∞—Ä–Ω–∞

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –û–±–∞ observer'–∞ –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å `onLoadMore` –ø–æ—á—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ #4: –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –≤ fetchStickerSets

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: —Å—Ç—Ä–æ–∫–∏ 212-319

**–ü—Ä–æ–±–ª–µ–º–∞**:
`fetchStickerSets` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏ —É–∂–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `page`, –±—É–¥—É—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –õ–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é

### üü° –ü—Ä–æ–±–ª–µ–º–∞ #5: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: useStickerStore.ts —Å—Ç—Ä–æ–∫–∏ 72-78

**–ü—Ä–æ–±–ª–µ–º–∞**:
`addStickerSets` –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –º–∞—Å—Å–∏–≤ `stickerSets` –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–º.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –í–æ–∑–º–æ–∂–Ω—ã–π –∫—Ä–∞—à –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. –î–æ–±–∞–≤–∏—Ç—å ref –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

```typescript
const isLoadingMoreRef = useRef(false);

const loadMoreStickerSets = useCallback(() => {
  // –ê—Ç–æ–º–∞—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞
  if (isLoadingMoreRef.current || isLoadingMore || currentPage >= totalPages - 1) {
    return;
  }
  
  isLoadingMoreRef.current = true;
  fetchStickerSets(currentPage + 1, true, selectedCategories)
    .finally(() => {
      isLoadingMoreRef.current = false;
    });
}, [currentPage, totalPages, isLoadingMore, selectedCategories, fetchStickerSets]);
```

### 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É response.number

```typescript
setPagination(
  response.number ?? page,  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º nullish coalescing
  response.totalPages ?? 0,
  response.totalElements ?? 0
);
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –≤ fetchStickerSets

```typescript
const fetchStickerSets = useCallback(async (
  page: number = 0, 
  isLoadMore: boolean = false,
  filterCategories?: string[]
) => {
  // –ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
  if (isLoadMore && isLoadingMore) {
    console.warn('‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
    return;
  }
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}, [...]);
```

### 4. –£–±—Ä–∞—Ç—å prefetch observer –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É

–õ–∏–±–æ —É–±—Ä–∞—Ç—å prefetch observer, –ª–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ref.

### 5. –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

```typescript
const MAX_LOADED_PAGES = 10; // –ú–∞–∫—Å–∏–º—É–º 10 —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –ø–∞–º—è—Ç–∏

if (stickerSets.length > MAX_LOADED_PAGES * 20) {
  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ
  const keepCount = (MAX_LOADED_PAGES - 2) * 20;
  setStickerSets(stickerSets.slice(-keepCount));
}
```

