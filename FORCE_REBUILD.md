# üöÄ –ö–∞–∫ —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–±–∏–ª–¥ –Ω–∞ Amvera

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ –ø—Ä–æ–¥–µ –∑–∞–ø—É—â–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ —Å –æ—à–∏–±–∫–æ–π `storedInitData is not defined`.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Amvera UI (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. –û—Ç–∫—Ä–æ–π https://console.amvera.ru/
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç `sticker-art-e13nst`
3. –ù–∞–∂–º–∏ **"Deploy"** –∏–ª–∏ **"Rebuild"**
4. –î–æ–∂–¥–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏ (5-10 –º–∏–Ω—É—Ç)
5. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Amvera CLI

```bash
# 1. –õ–æ–≥–∏–Ω (–µ—Å–ª–∏ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω)
amvera login

# 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–±–∏–ª–¥
amvera rebuild sticker-art-e13nst

# 3. –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ —Å–±–æ—Ä–∫–∏
amvera logs build sticker-art-e13nst --follow

# 4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å runtime –ª–æ–≥–∏
amvera logs run sticker-art-e13nst --follow
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Dummy commit –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–µ–ø–ª–æ—è

–ï—Å–ª–∏ Amvera –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ push:

```bash
# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π –∫–æ–º–º–∏—Ç
git commit --allow-empty -m "chore: trigger rebuild"

# –ó–∞–ø—É—à–∏—Ç—å
git push origin main

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Amvera –Ω–∞—á–∞–ª –¥–µ–ø–ª–æ–π
amvera logs build sticker-art-e13nst --follow
```

## üîß –ü—Ä–æ–±–ª–µ–º–∞: Docker –∫—ç—à–∏—Ä—É–µ—Ç —Å–ª–æ–∏ —Å–±–æ—Ä–∫–∏

### –°–∏–º–ø—Ç–æ–º—ã:
- –ö–æ–¥ –∏–∑–º–µ–Ω–∏–ª—Å—è –≤ GitHub
- Amvera –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—É—é —Å–±–æ—Ä–∫—É
- –ù–æ –Ω–∞ –ø—Ä–æ–¥–µ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (—Å—Ç–∞—Ä—ã–π hash –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤)

### –ü—Ä–∏—á–∏–Ω–∞:
Docker –∫—ç—à–∏—Ä—É–µ—Ç —Å–ª–æ–∏. –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è Docker, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à.

### –†–µ—à–µ–Ω–∏–µ –≤ Dockerfile:

```dockerfile
# ARG CACHEBUST –¥–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
ARG CACHEBUST=1

# –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π
RUN rm -rf dist && \
    npx tsc && \
    npx vite build
```

### –§–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å –Ω–æ–≤—ã–º CACHEBUST:

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
docker build --build-arg CACHEBUST=$(date +%s) -t sticker-art .

# –ß–µ—Ä–µ–∑ Amvera (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç build args)
# - –û–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ª—é–±–æ–π —Ñ–∞–π–ª –≤ miniapp/
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ nginx —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª –±–µ–∑ –æ—à–∏–±–æ–∫:

```bash
amvera logs run sticker-art-e13nst | tail -50
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
nginx: configuration file /etc/nginx/nginx.conf test is successful
...
```

### 2. –ü—Ä–æ–≤–µ—Ä—å –≤–µ—Ä—Å–∏—é —Ñ–∞–π–ª–æ–≤ (hash –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å—Å—è):

```bash
curl -s https://sticker-art-e13nst.amvera.io/miniapp/ | grep -o 'index-[^"]*\.js'
```

–°–µ–π—á–∞—Å: `index-CPVuJ2V4.js` (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è —Å –±–∞–≥–æ–º)
–ü–æ—Å–ª–µ —Ä–µ–±–∏–ª–¥–∞: `index-XXXXXXXX.js` (–Ω–æ–≤—ã–π hash)

### 3. –û—Ç–∫—Ä–æ–π –±—Ä–∞—É–∑–µ—Ä –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ:

```
https://sticker-art-e13nst.amvera.io/miniapp/
```

**Hard refresh (Ctrl+Shift+R)** —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞!

### 4. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üîß DEV MODE: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è mock Telegram –æ–∫—Ä—É–∂–µ–Ω–∏–µ  // –∏–ª–∏
üîß PRODUCTION MODE: initData –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
```

–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚ùå ReferenceError: storedInitData is not defined
```

### 5. –ó–∞–ø—É—Å—Ç–∏ E2E —Ç–µ—Å—Ç—ã:

```bash
npm run test:prod
```

–î–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É >10 –∫–∞—Ä—Ç–æ—á–µ–∫.

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Amvera –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–µ–ø–ª–æ–π

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å webhook –≤ GitHub

1. GitHub ‚Üí Settings ‚Üí Webhooks
2. –ù–∞–π–¥–∏ webhook –¥–ª—è Amvera
3. –ü—Ä–æ–≤–µ—Ä—å Recent Deliveries
4. –ï—Å–ª–∏ failed - –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π webhook —á–µ—Ä–µ–∑ Amvera UI

### –ü—Ä–æ–±–ª–µ–º–∞: –î–µ–ø–ª–æ–π –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏

```bash
amvera logs build sticker-art-e13nst
```

–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:
- `npm ci` failed ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å `package.json`
- `tsc` failed ‚Üí TypeScript –æ—à–∏–±–∫–∏
- `vite build` failed ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å–±–æ—Ä–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥–∞

```bash
amvera exec sticker-art-e13nst -- nginx -t
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ `mkdir() "/data/nginx/cache" failed` ‚Üí —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∫–æ–º–º–∏—Ç–µ.

### –ü—Ä–æ–±–ª–µ–º–∞: –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é

**–†–µ—à–µ–Ω–∏–µ**: –°–±—Ä–æ—Å –∫—ç—à–∞

1. **Hard refresh**: Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)
2. **–ò–ª–∏**: –†–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
3. **–ò–ª–∏**: –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot GET /miniapp/"

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏—Å—å

```bash
amvera exec sticker-art-e13nst -- ls -la /usr/share/nginx/html/miniapp/
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- `index.html`
- `assets/` (—Å JS/CSS —Ñ–∞–π–ª–∞–º–∏)

## –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ö–æ–¥ –≤ GitHub —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (‚úÖ –¥–∞, –∫–æ–º–º–∏—Ç `5c3877e`)
- [ ] –ó–∞–ø—É—â–µ–Ω —Ä–µ–±–∏–ª–¥ —á–µ—Ä–µ–∑ UI –∏–ª–∏ CLI
- [ ] –õ–æ–≥–∏ —Å–±–æ—Ä–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—Ö
- [ ] Nginx —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Hash —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–∏–ª—Å—è (–Ω–µ `index-CPVuJ2V4.js`)
- [ ] –ë—Ä–∞—É–∑–µ—Ä –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
- [ ] –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –±–µ–∑ –æ—à–∏–±–æ–∫ `storedInitData`
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
echo "=== GIT STATUS ===" && \
git log --oneline -1 && \
echo "\n=== BUILD LOGS ===" && \
amvera logs build sticker-art-e13nst | tail -20 && \
echo "\n=== RUN LOGS ===" && \
amvera logs run sticker-art-e13nst | tail -20 && \
echo "\n=== FILE HASH ===" && \
curl -s https://sticker-art-e13nst.amvera.io/miniapp/ | grep -o 'index-[^"]*\.js'
```

