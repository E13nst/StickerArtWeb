#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è StickerArt
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./check-env.sh

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è StickerArt..."
echo "=============================================="

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
required_vars=(
  "BACKEND_URL"
  "GRAFANA_ADMIN_USER" 
  "GRAFANA_ADMIN_PASSWORD"
)

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
optional_vars=(
  "NODE_ENV"
  "PROMETHEUS_RETENTION_TIME"
  "LOG_LEVEL"
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
echo -e "\n${YELLOW}üìã –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:${NC}"
all_required_set=true

for var in "${required_vars[@]}"; do
  if [ -z "${!var}" ]; then
    echo -e "‚ùå ${RED}$var${NC} - –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
    all_required_set=false
  else
    # –°–∫—Ä—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª—å –≤ –≤—ã–≤–æ–¥–µ
    if [[ "$var" == *"PASSWORD"* ]]; then
      echo -e "‚úÖ ${GREEN}$var${NC} - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (${#!var} —Å–∏–º–≤–æ–ª–æ–≤)"
    else
      echo -e "‚úÖ ${GREEN}$var${NC} - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
    fi
  fi
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
echo -e "\n${YELLOW}üìù –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:${NC}"
for var in "${optional_vars[@]}"; do
  if [ -z "${!var}" ]; then
    echo -e "‚ö™ $var - –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
  else
    echo -e "‚úÖ ${GREEN}$var${NC} - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
  fi
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
echo -e "\n${YELLOW}üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è Grafana:${NC}"
if [ -n "$GRAFANA_ADMIN_PASSWORD" ]; then
  password_length=${#GRAFANA_ADMIN_PASSWORD}
  
  if [ $password_length -lt 8 ]; then
    echo -e "‚ö†Ô∏è  ${RED}–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)${NC}"
  elif [ $password_length -lt 12 ]; then
    echo -e "‚ö†Ô∏è  ${YELLOW}–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –¥–ª–∏–Ω–Ω–µ–µ 12 —Å–∏–º–≤–æ–ª–æ–≤${NC}"
  else
    echo -e "‚úÖ ${GREEN}–î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è: $password_length —Å–∏–º–≤–æ–ª–æ–≤${NC}"
  fi
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
  if [[ "$GRAFANA_ADMIN_PASSWORD" =~ [A-Z] ]] && [[ "$GRAFANA_ADMIN_PASSWORD" =~ [a-z] ]] && [[ "$GRAFANA_ADMIN_PASSWORD" =~ [0-9] ]]; then
    echo -e "‚úÖ ${GREEN}–ü–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–ª–∞–≤–Ω—ã–µ, —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã${NC}"
  else
    echo -e "‚ö†Ô∏è  ${YELLOW}–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≥–ª–∞–≤–Ω—ã–µ, —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã${NC}"
  fi
fi

# –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo -e "\n${YELLOW}üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:${NC}"
if [ "$all_required_set" = true ]; then
  echo -e "üéâ ${GREEN}–í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!${NC}"
  echo -e "üöÄ ${GREEN}–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É${NC}"
  exit 0
else
  echo -e "‚ùå ${RED}–ù–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã${NC}"
  echo -e "üìñ ${YELLOW}–°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: HOSTING_ENV.md${NC}"
  exit 1
fi
