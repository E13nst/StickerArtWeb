/* StixlyTopHeader iOS Safe Area Support */
/* This stylesheet ensures the header extends into the iOS notch area */

:root {
  --stixly-header-bg: linear-gradient(90deg, #ff80bf 0%, #6e55ff 100%);
  --stixly-header-height: 140px; /* Default header height, will be updated dynamically */
}

/* Единый фон приложения (fallback когда контент ещё не отрисован) */
html, body {
  background-color: var(--color-background);
}

/* StixlyTopHeader - Fixed positioning with safe area support */
/* Use higher specificity selectors to ensure CSS wins over inline styles */
html header#stixlytopheader.stixly-top-header,
html header#stixlytopheader.stixlytopheader,
html header.stixlytopheader,
html #stixlytopheader,
html .stixlytopheader,
header#stixlytopheader.stixly-top-header,
header#stixlytopheader,
header.stixlytopheader,
#stixlytopheader,
.stixlytopheader {
  position: fixed !important; /* must be fixed to sit under the status bar */
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  width: 100% !important;
  /* Header: below UI controls and all modals */
  z-index: var(--z-header, 100) !important;
  
  /* extend into the iPhone notch area using Telegram safe area insets */
  /* Fallback to env() for old clients without Telegram safe area insets */
  padding-top: calc(
    var(--tg-safe-area-inset-top, env(safe-area-inset-top, 0px)) +
    var(--tg-content-safe-area-inset-top, 0px)
  ) !important;
  
  /* background will be handled by inner elements */
  background: transparent !important;
  
  /* Гарантируем, что header всегда виден и не обрезается родителями */
  transform: none !important;
  will-change: auto !important;
}

/* Inner header content divs - these keep relative positioning but inherit safe area padding */
header#stixlytopheader > .stixlytopheader,
header#stixlytopheader > .stixly-top-header,
header.stixlytopheader > .stixlytopheader,
header.stixlytopheader > .stixly-top-header {
  /* Keep relative positioning for layout, but ensure it accounts for safe area */
  position: relative !important;
  width: 100% !important;
  /* min-height accounts for safe area at parent level */
}

/* Regular header mode */
.stixly-top-header:not(.stixly-top-header--profile) {
  /* min-height убран, высота определяется контентом */
}

/* Profile mode header */
.stixly-top-header--profile {
  /* min-height убран, высота определяется контентом */
}

/* Ensure the inner content of the header accounts for safe area */
header#stixlytopheader > .stixlytopheader > *,
header#stixlytopheader > .stixly-top-header > *,
header.stixlytopheader > .stixlytopheader > *,
header.stixlytopheader > .stixly-top-header > * {
  /* Content should start below the safe area */
  position: relative;
  z-index: 1;
}

/* Avoid scroll gap under fixed header - only apply when header exists */
/* ИСКЛЮЧАЕМ .stixly-main-scroll, так как он сам управляет padding-top */
.stixly-main-layout:has(header#stixlytopheader) > div:not([class*="bottom"]):not([class*="Bottom"]):not(.stixly-main-scroll) {
  /* adjust the page content start to account for fixed header */
  padding-top: var(--stixly-header-height) !important;
}

/* For pages with profile mode header, adjust padding accordingly */
.stixly-main-layout:has(.stixly-top-header--profile) > div:not([class*="bottom"]):not([class*="Bottom"]):not(.stixly-main-scroll) {
  padding-top: var(--stixly-header-height) !important;
}

/* Fallback for browsers that don't support :has() - apply to all content divs */
@supports not selector(:has(*)) {
  .stixly-main-layout > div:first-of-type:not([class*="bottom"]):not([class*="Bottom"]):not(.stixly-main-scroll) {
    padding-top: var(--stixly-header-height) !important;
  }
}

/* Main scroll container — фон задаётся инлайном в MainLayout (transparent), чтобы под хедером на iOS был виден градиент страницы; fallback для страниц без градиента */
.stixly-main-scroll {
  flex: 1 1 auto;
  position: relative;
  isolation: isolate;
  height: calc(100vh - var(--stixly-bottom-nav-height, 0px));
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: none;
  background-color: transparent;
  background-image: none;
}

/* Conditional padding-top only when header is visible */
/* Добавляем отступ только к первому дочернему элементу, который не является fixed/sticky */
.stixly-main-layout:has(header#stixlytopheader) .stixly-main-scroll > *:first-child:not(.compact-controls-bar) {
  padding-top: var(--stixly-header-height, 0px);
}

/* Отступ для GalleryPage теперь управляется внутри SimpleGallery через paddingTop gallery-items */

/* Для DashboardPage - добавляем отступ к Box с Container */
.stixly-main-layout:has(header#stixlytopheader) .stixly-main-scroll > .MuiBox-root:first-child {
  padding-top: var(--stixly-header-height, 0px);
}

/* For pages without header (profile/author), no padding-top */
.stixly-main-layout:not(:has(header#stixlytopheader)) .stixly-main-scroll > *:first-child {
  padding-top: 0;
}

/* Defensive: if env() is unsupported, keep it neat */
@supports not (padding: env(safe-area-inset-top)) {
  header#stixlytopheader,
  header.stixlytopheader,
  #stixlytopheader,
  .stixlytopheader {
    padding-top: calc(
      var(--tg-safe-area-inset-top, 0px) +
      var(--tg-content-safe-area-inset-top, 0px)
    ) !important;
  }
  
  .stixly-top-header:not(.stixly-top-header--profile) {
    /* min-height убран, высота определяется контентом */
  }
  
  .stixly-top-header--profile {
    /* min-height убран, высота определяется контентом */
  }
  
  .stixly-main-layout:has(header#stixlytopheader) > div:not(.bottom-nav) {
    padding-top: var(--stixly-header-height) !important;
  }
  
  .stixly-main-layout:has(.stixly-top-header--profile) > div:not(.bottom-nav) {
    padding-top: var(--stixly-header-height) !important;
  }
  
  /* Fallback for browsers without :has() support */
  @supports not selector(:has(*)) {
    .stixly-main-layout > div:first-of-type {
      padding-top: var(--stixly-header-height) !important;
    }
  }
}

/* Inner wrapper for header content - ограничивает ширину на широких экранах */
.stixly-top-header-inner {
  width: 100%;
  max-width: 600px; /* узкий лейаут для основного контента */
  margin: 0 auto;
  padding: 0 16px; /* чтобы на широких экранах не липло к краям */
  box-sizing: border-box;
}

/* Inner wrapper for CompactControlsBar — ширина и центр; padding единый в CompactControlsBar.css */
.compact-controls-bar-inner {
  position: relative;
  width: 100%;
  max-width: 600px;
  margin: 0 auto;
  box-sizing: border-box;
}

/* Hide topheader on iOS if it exists (stixlytopheader should be used instead) */
.ios .topheader,
.platform-ios .topheader,
body.ios .topheader,
body.platform-ios .topheader {
  display: none !important;
}

