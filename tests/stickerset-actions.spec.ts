import { test, expect, Page } from '@playwright/test';

// @ts-ignore - process –¥–æ—Å—Ç—É–ø–µ–Ω –≤ Node.js –æ–∫—Ä—É–∂–µ–Ω–∏–∏ Playwright
declare const process: any;

/**
 * üß™ –ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ô –¢–ï–°–¢: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞
 * 
 * –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Å–ª–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞ 
 * –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å availableActions –æ—Ç API
 */

test.describe('StickerSet Actions: Block/Unblock', () => {
  let adminInitData: string;
  
  test.beforeAll(async () => {
    // –ü–æ–ª—É—á–∞–µ–º initData –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
    adminInitData = process.env.TELEGRAM_INIT_DATA || '';
    
    if (!adminInitData) {
      console.warn('‚ö†Ô∏è TELEGRAM_INIT_DATA –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
      console.warn('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_INIT_DATA –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.');
      console.warn('–ü–æ–¥—Ä–æ–±–Ω–µ–µ: —Å–º. tests/README.md');
      throw new Error('TELEGRAM_INIT_DATA is required for this test');
    }
    
    console.log('‚úÖ TELEGRAM_INIT_DATA –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è');
  });
  
  test.beforeEach(async ({ page }) => {
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫
    await page.route('**/*', async (route) => {
      const headers = {
        ...route.request().headers(),
        'X-Telegram-Init-Data': adminInitData
      };
      await route.continue({ headers });
    });
    
    console.log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ X-Telegram-Init-Data');
    
    // –õ–æ–≥–∏—Ä—É–µ–º –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    page.on('console', msg => {
      const text = msg.text();
      if (text.includes('availableActions') || text.includes('–°—Ç–∏–∫–µ—Ä—Å–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω')) {
        console.log(`üñ•Ô∏è  ${text}`);
      }
    });
  });
  
  test('–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π', async ({ page }) => {
    console.log('\nüöÄ –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞...\n');
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –≤ –≥–∞–ª–µ—Ä–µ—é –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('üìÑ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –≥–∞–ª–µ—Ä–µ—é...');
    await page.goto('/miniapp/', { waitUntil: 'domcontentloaded' });
    
    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏
    await page.waitForSelector('[data-testid="gallery-container"]', { timeout: 10000 });
    console.log('‚úÖ –ì–∞–ª–µ—Ä–µ—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    await page.waitForSelector('[data-testid="pack-card"]', { timeout: 10000 });
    const packsCount = await page.locator('[data-testid="pack-card"]').count();
    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${packsCount} –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–æ–≤`);
    
    expect(packsCount).toBeGreaterThan(0);
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç
    console.log('üñ±Ô∏è  –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞...');
    const firstCard = page.locator('[data-testid="pack-card"]').first();
    await firstCard.click();
    
    // –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏
    await page.waitForTimeout(1000); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã–ª–æ—Å—å (–µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π)
    const detailCard = page.locator('.sticker-detail-info-card');
    await expect(detailCard).toBeVisible({ timeout: 5000 });
    console.log('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—Ç–∫—Ä—ã—Ç–æ');
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('\nüìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—ç–º–æ–¥–∑–∏ üö´)
    const blockButton = page.locator('button').filter({ hasText: 'üö´' });
    const unblockButton = page.locator('button').filter({ hasText: 'üîÑ' });
    
    const hasBlockButton = await blockButton.isVisible().catch(() => false);
    const hasUnblockButton = await unblockButton.isVisible().catch(() => false);
    
    console.log(`  - –ö–Ω–æ–ø–∫–∞ "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" (üö´): ${hasBlockButton ? '–í–∏–¥–∏–º–∞' : '–°–∫—Ä—ã—Ç–∞'}`);
    console.log(`  - –ö–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" (üîÑ): ${hasUnblockButton ? '–í–∏–¥–∏–º–∞' : '–°–∫—Ä—ã—Ç–∞'}`);
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞
    const initiallyBlocked = hasUnblockButton;
    console.log(`  üìå –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: ${initiallyBlocked ? '–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù' : '–ù–ï –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù'}`);
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 3: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞ (–µ—Å–ª–∏ –æ–Ω –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    if (!initiallyBlocked) {
      console.log('\nüö´ –¢–ï–°–¢: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞...');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤–∏–¥–∏–º–∞
      await expect(blockButton).toBeVisible({ timeout: 5000 });
      
      // –ù–∞–∂–∏–º–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      console.log('  üñ±Ô∏è  –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"...');
      await blockButton.click();
      
      // –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      await page.waitForTimeout(500);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∏–∞–ª–æ–≥–∞ —Å –ø–æ–ª–µ–º –¥–ª—è –ø—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      const dialogTitle = page.locator('text=–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç');
      await expect(dialogTitle).toBeVisible({ timeout: 3000 });
      console.log('  ‚úÖ –î–∏–∞–ª–æ–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç–∫—Ä—ã–ª—Å—è');
      
      // –í–≤–æ–¥–∏–º –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      const reasonInput = page.locator('textarea[placeholder*="–ù–∞–ø—Ä–∏–º–µ—Ä"]');
      if (await reasonInput.isVisible().catch(() => false)) {
        await reasonInput.fill('–ê–≤—Ç–æ—Ç–µ—Å—Ç: –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
        console.log('  ‚úçÔ∏è  –í–≤–µ–¥–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
      }
      
      // –ù–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      const confirmButton = page.locator('button:has-text("–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å")').last();
      console.log('  üñ±Ô∏è  –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...');
      await confirmButton.click();
      
      // –ñ–¥–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
      console.log('  ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI...');
      await page.waitForTimeout(2000);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∏–∞–ª–æ–≥ –∑–∞–∫—Ä—ã–ª—Å—è
      await expect(dialogTitle).not.toBeVisible({ timeout: 3000 });
      console.log('  ‚úÖ –î–∏–∞–ª–æ–≥ –∑–∞–∫—Ä—ã–ª—Å—è');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –ª–æ–≥ –æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ availableActions
      await page.waitForTimeout(500);
      
      // –ü–†–û–í–ï–†–ö–ê: –ö–Ω–æ–ø–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å, –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      console.log('  üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏...');
      
      await expect(blockButton).not.toBeVisible({ timeout: 5000 });
      console.log('  ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" (üö´) —Å–∫—Ä—ã—Ç–∞');
      
      await expect(unblockButton).toBeVisible({ timeout: 5000 });
      console.log('  ‚úÖ –ö–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" (üîÑ) –ø–æ—è–≤–∏–ª–∞—Å—å');
      
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: alert –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
      const blockAlert = page.locator('text=–ù–∞–±–æ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
      const alertVisible = await blockAlert.isVisible().catch(() => false);
      console.log(`  ${alertVisible ? '‚úÖ' : '‚ö†Ô∏è'} Alert –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ: ${alertVisible ? '–í–∏–¥–∏–º' : '–ù–µ –≤–∏–¥–∏–º'}`);
    } else {
      console.log('\n‚ö†Ô∏è –°—Ç–∏–∫–µ—Ä—Å–µ—Ç —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –®–ê–ì 4: –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('\nüîÑ –¢–ï–°–¢: –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–∞...');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä (–∫–Ω–æ–ø–∫–∞ –º–æ–≥–ª–∞ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)
    const currentUnblockButton = page.locator('button').filter({ hasText: 'üîÑ' });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤–∏–¥–∏–º–∞
    await expect(currentUnblockButton).toBeVisible({ timeout: 5000 });
    
    // –ù–∞–∂–∏–º–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    console.log('  üñ±Ô∏è  –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"...');
    await currentUnblockButton.click();
    
    // –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    await page.waitForTimeout(500);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∏–∞–ª–æ–≥–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    const unblockDialogTitle = page.locator('text=–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç');
    await expect(unblockDialogTitle).toBeVisible({ timeout: 3000 });
    console.log('  ‚úÖ –î–∏–∞–ª–æ–≥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç–∫—Ä—ã–ª—Å—è');
    
    // –ù–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    const confirmUnblockButton = page.locator('button:has-text("–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å")').last();
    console.log('  üñ±Ô∏è  –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...');
    await confirmUnblockButton.click();
    
    // –ñ–¥–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
    console.log('  ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI...');
    await page.waitForTimeout(2000);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∏–∞–ª–æ–≥ –∑–∞–∫—Ä—ã–ª—Å—è
    await expect(unblockDialogTitle).not.toBeVisible({ timeout: 3000 });
    console.log('  ‚úÖ –î–∏–∞–ª–æ–≥ –∑–∞–∫—Ä—ã–ª—Å—è');
    
    // –ü–†–û–í–ï–†–ö–ê: –ö–Ω–æ–ø–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å, –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    console.log('  üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏...');
    
    await page.waitForTimeout(500);
    
    const finalBlockButton = page.locator('button').filter({ hasText: 'üö´' });
    const finalUnblockButton = page.locator('button').filter({ hasText: 'üîÑ' });
    
    await expect(finalUnblockButton).not.toBeVisible({ timeout: 5000 });
    console.log('  ‚úÖ –ö–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" (üîÑ) —Å–∫—Ä—ã—Ç–∞');
    
    await expect(finalBlockButton).toBeVisible({ timeout: 5000 });
    console.log('  ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" (üö´) –ø–æ—è–≤–∏–ª–∞—Å—å –æ–±—Ä–∞—Ç–Ω–æ');
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: alert –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –¥–æ–ª–∂–µ–Ω –∏—Å—á–µ–∑–Ω—É—Ç—å
    const blockAlert = page.locator('text=–ù–∞–±–æ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
    const alertVisible = await blockAlert.isVisible().catch(() => false);
    console.log(`  ${!alertVisible ? '‚úÖ' : '‚ö†Ô∏è'} Alert –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ: ${alertVisible ? '–í–∏–¥–∏–º' : '–ù–µ –≤–∏–¥–∏–º (–æ–∂–∏–¥–∞–µ—Ç—Å—è)'}`);
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –§–ò–ù–ê–õ: –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('\n‚úÖ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û');
    console.log('‚ïê'.repeat(80));
    console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
    console.log('‚ïê'.repeat(80) + '\n');
  });
  
  test('–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–∏–∫–ª–∞: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Üí —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞', async ({ page }) => {
    console.log('\nüîÅ –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏...\n');
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≥–∞–ª–µ—Ä–µ—é –∏ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç
    await page.goto('/miniapp/', { waitUntil: 'domcontentloaded' });
    await page.waitForSelector('[data-testid="pack-card"]', { timeout: 10000 });
    await page.locator('[data-testid="pack-card"]').first().click();
    await page.waitForTimeout(1000);
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    const blockStickerSet = async () => {
      const blockBtn = page.locator('button').filter({ hasText: 'üö´' });
      await blockBtn.click();
      await page.waitForTimeout(500);
      await page.locator('button:has-text("–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å")').last().click();
      await page.waitForTimeout(2000);
    };
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    const unblockStickerSet = async () => {
      const unblockBtn = page.locator('button').filter({ hasText: 'üîÑ' });
      await unblockBtn.click();
      await page.waitForTimeout(500);
      await page.locator('button:has-text("–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å")').last().click();
      await page.waitForTimeout(2000);
    };
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–Ω–æ–ø–æ–∫
    const checkButtons = async (shouldBeBlocked: boolean) => {
      const blockBtn = page.locator('button').filter({ hasText: 'üö´' });
      const unblockBtn = page.locator('button').filter({ hasText: 'üîÑ' });
      
      if (shouldBeBlocked) {
        await expect(unblockBtn).toBeVisible();
        await expect(blockBtn).not.toBeVisible();
      } else {
        await expect(blockBtn).toBeVisible();
        await expect(unblockBtn).not.toBeVisible();
      }
    };
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    const initialUnblockBtn = page.locator('button').filter({ hasText: 'üîÑ' });
    const initiallyBlocked = await initialUnblockBtn.isVisible().catch(() => false);
    
    // –¶–∏–∫–ª 1: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
    if (!initiallyBlocked) {
      console.log('1Ô∏è‚É£ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞...');
      await blockStickerSet();
      await checkButtons(true);
      console.log('‚úÖ –ü–æ—Å–ª–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã');
    }
    
    // –¶–∏–∫–ª 2: –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    console.log('2Ô∏è‚É£ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞...');
    await unblockStickerSet();
    await checkButtons(false);
    console.log('‚úÖ –ü–æ—Å–ª–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã');
    
    // –¶–∏–∫–ª 3: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    console.log('3Ô∏è‚É£ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞...');
    await blockStickerSet();
    await checkButtons(true);
    console.log('‚úÖ –ü–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã');
    
    // –¶–∏–∫–ª 4: –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–≤–æ–∑–≤—Ä–∞—Ç –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
    console.log('4Ô∏è‚É£ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞...');
    await unblockStickerSet();
    await checkButtons(false);
    console.log('‚úÖ –ü–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã');
    
    console.log('\n‚úÖ –ü–û–õ–ù–´–ô –¶–ò–ö–õ –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û');
  });
});

